{% set files = site.static|filter(f => f.path matches '/^photos/')|sort((a, b) => a.exif.DateTimeOriginal|default(a.date)|date('U') <=> b.exif.DateTimeOriginal|default(b.date)|date('U')) %}
{% if site.photos.sort == 'desc'|default('asc') %}
	{%- set files = files|reverse %}
{% endif %}
{% set image = files|first.path %}
{% extends '_default/page.html.twig' %}

      {%- block css ~%}
      {{ parent() }}
      div#gallery {
        display: flex;
        flex-wrap: wrap;
      }
      div#gallery::after {
        content: '';
        flex-grow: 999999999;
      }
      #gallery h1.title {
        position: fixed;
        z-index: 1;
        margin: 0.5rem;
        font-size: x-large;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      #gallery h1.title a {
        text-decoration: none;
      }
      #gallery h1.title a:hover {
        -webkit-font-smoothing: auto;
        -moz-osx-font-smoothing: auto;
      }
      #gallery div.photo {
        flex-grow: 1;
        position: relative;
        margin: $margin;
        height: $height;
        background-color: $background;
      }
      #gallery img {
        object-fit: cover;
        height: $height;
        width: 100%;
        max-width: 100%;
        min-width: 100%;
        vertical-align: bottom;
        filter: alpha(opacity=80);
        opacity: 0.8;
      }
      #gallery img:hover {
        filter: alpha(opacity=100);
        opacity: 1;
      }
      #gallery div.data {
        position: absolute;
        bottom: 0px;
        left: 0px;
        padding: .2rem 0 .1rem .25rem;
        width: 100%;
        font-size: small;
        font-style: italic;
        line-height: normal;
        background-color: $background;
        opacity: .4;
      }
      #gallery div.data:hover {
        background-color: $background;
        opacity: 1;
      }
      #gallery div.data a {
        text-decoration: none;
      }
      #gallery span.author {
        font-style: normal;
      }
      {%- endblock css ~%}

      {%- block content ~%}
      <div id="gallery">
        <h1 class="title"><a href="{{ url('/') }}" title="{{ site.description|default(site.title) }}">{{ site.title }}</a></h1>
        {%- for file in files ~%}
          {%- if site.data.photos[file.basename] is defined ~%}
            {%- set photo = site.data.photos[file.basename] -%}
          {%- endif ~%}
          {%- set image = asset(file.path)|resize(site.photos.size.thumbnail) ~%}
        <div class="photo" style="background-color: {{ image|dominant_color }}">
          {%- set attributes = {'alt': photo.alt|default(photo.title|default)} -%}
          {%- if loop.index > 10 %}{% set attributes = attributes|merge({'loading': 'lazy'}) %}{% endif ~%}
          <a data-fslightbox="gallery" href="{{ url(asset(file.path)|resize(site.photos.size.full)) }}" aria-label="{{ "Click to view this photo in full size"|trans }}">
            {{ image|html(attributes) }}
          </a>
          {%- if photo.title is defined or photo.author.name is defined ~%}
          <div class="data">
            {%- if photo.title is defined ~%}
            <em>{{ photo.title }}</em>
            {%- endif ~%}
            {%- if photo.title is defined and photo.author.name is defined %} &middot; {% endif ~%}
            {%- if photo.author.name is defined ~%}
            {%- set author -%}
              {%- if photo.author.url is defined -%}
                <a href="{{ photo.author.url }}" title="{% trans %}Author's page{% endtrans %}">{{ photo.author.name }}</a>
              {%- else -%}
                {{ photo.author.name }}
              {%- endif -%}
            {%- endset ~%}
            <span class="author">{%- trans %}Credit: %author%{% endtrans ~%}</span>
            {%- endif ~%}
          </div>
          {%- endif ~%}
        </div>
        {%- set photo = '' -%}
        {%- endfor ~%}
      </div>
      <script src="{{ asset('js/fslightbox.js') }}"></script>
      {%- endblock ~%}